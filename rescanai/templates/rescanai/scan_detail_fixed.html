{% extends 'rescanai/base.html' %}

{% block title %}Scan Results - #{{ scan.id }}{% endblock %}

{% block content %}
<div style="max-width: 100%; margin: 0;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2 style="color: #00FF9C; margin: 0;">Scan Results - #{{ scan.id }}</h2>
        <a href="{% url 'rescanai:index' %}" style="color: #8B949E; text-decoration: none;">‚Üê Back to Dashboard</a>
    </div>

    <!-- Target Summary Panel -->
    <div style="background: #161B22; border-radius: 12px; padding: 30px; border: 1px solid rgba(0, 255, 156, 0.2); margin-bottom: 20px;">
        <h3 style="color: #00FF9C; margin-bottom: 20px;">Target Summary</h3>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
            <div>
                <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 5px;">Target</div>
                <div style="color: #00BFFF; font-size: 1.2em; font-weight: bold;">{{ scan.target.target_value }}</div>
                <div style="color: #8B949E; font-size: 0.85em; margin-top: 3px;">{{ scan.target.name }}</div>
            </div>
            <div>
                <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 5px;">Scan Type</div>
                <div style="color: #E6EDF3; font-size: 1.2em; font-weight: bold;">{{ scan.scan_type|upper }}</div>
            </div>
            <div>
                <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 5px;">Scan Timestamp</div>
                <div style="color: #E6EDF3; font-size: 1em;">{{ scan.started_at|date:"Y-m-d H:i:s" }}</div>
                <div style="color: #8B949E; font-size: 0.85em; margin-top: 3px;">
                    {% if scan.completed_at %}Completed: {{ scan.completed_at|date:"H:i:s" }}{% else %}In Progress{% endif %}
                </div>
            </div>
            <div>
                <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 5px;">Overall Risk Score</div>
                <div style="font-size: 2em; font-weight: bold; color: {% if scan.risk_score >= 7 %}#FF003C{% elif scan.risk_score >= 4 %}#FFD700{% else %}#00FF9C{% endif %};">
                    {% if scan.risk_score > 0 %}{{ scan.risk_score|floatformat:1 }}/10{% else %}N/A{% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 20px;">
        <div style="background: #161B22; padding: 20px; border-radius: 12px; border: 1px solid rgba(0, 191, 255, 0.3);">
            <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 5px;">Open Ports</div>
            <div style="color: #00BFFF; font-size: 2em; font-weight: bold;">{{ ports.count }}</div>
        </div>
        <div style="background: #161B22; padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 0, 60, 0.3);">
            <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 5px;">Critical Issues</div>
            <div style="color: #FF003C; font-size: 2em; font-weight: bold;">{{ severity_counts.critical }}</div>
        </div>
        <div style="background: #161B22; padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 215, 0, 0.3);">
            <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 5px;">Total Vulnerabilities</div>
            <div style="color: #FFD700; font-size: 2em; font-weight: bold;">{{ vulnerabilities.count }}</div>
        </div>
        <div style="background: #161B22; padding: 20px; border-radius: 12px; border: 1px solid rgba(0, 255, 156, 0.3);">
            <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 5px;">Scan Status</div>
            <div style="color: {% if scan.status == 'completed' %}#00FF9C{% elif scan.status == 'running' %}#FFD700{% else %}#FF6A00{% endif %}; font-size: 1.5em; font-weight: bold;">
                {{ scan.status|upper }}
            </div>
        </div>
    </div>

    <!-- Phase 4: Enhanced Risk Scoring Panel -->
    {% if risk_breakdown %}
    <div style="background: linear-gradient(135deg, #161B22 0%, #1C2128 100%); border-radius: 12px; padding: 30px; border: 2px solid rgba(138, 43, 226, 0.3); margin-bottom: 20px; box-shadow: 0 0 20px rgba(138, 43, 226, 0.1);">
        <h3 style="color: #BA55D3; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#BA55D3" stroke-width="2">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            üöÄ Phase 4: Enhanced Risk Scoring
        </h3>
        
        <!-- Risk Metrics Grid -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
            <div style="background: rgba(186, 85, 211, 0.1); padding: 20px; border-radius: 10px; border: 1px solid rgba(186, 85, 211, 0.3);">
                <div style="color: #8B949E; font-size: 0.85em; margin-bottom: 5px;">Final Risk Score</div>
                <div style="font-size: 2.5em; font-weight: bold; color: {% if risk_breakdown and risk_breakdown.final_risk_score >= 8 %}#FF003C{% elif risk_breakdown and risk_breakdown.final_risk_score >= 6 %}#FF6A00{% elif risk_breakdown and risk_breakdown.final_risk_score >= 4 %}#FFD700{% else %}#00FF9C{% endif %};">
                    {% if risk_breakdown %}{{ risk_breakdown.final_risk_score }}/10{% else %}N/A{% endif %}
                </div>
                <div style="color: #8B949E; font-size: 0.8em; margin-top: 5px;">{% if risk_breakdown %}{{ risk_breakdown.risk_level|upper }}{% else %}PENDING{% endif %}</div>
            </div>
            <div style="background: rgba(0, 191, 255, 0.1); padding: 20px; border-radius: 10px; border: 1px solid rgba(0, 191, 255, 0.3);">
                <div style="color: #8B949E; font-size: 0.85em; margin-bottom: 5px;">Chain Amplification</div>
                <div style="color: #00BFFF; font-size: 2.5em; font-weight: bold;">{% if risk_breakdown %}{{ risk_breakdown.chain_amplification_factor }}x{% else %}N/A{% endif %}</div>
                <div style="color: #8B949E; font-size: 0.8em; margin-top: 5px;">Risk Multiplier</div>
            </div>
            <div style="background: rgba(255, 215, 0, 0.1); padding: 20px; border-radius: 10px; border: 1px solid rgba(255, 215, 0, 0.3);">
                <div style="color: #8B949E; font-size: 0.85em; margin-bottom: 5px;">Avg CVSS Score</div>
                <div style="color: #FFD700; font-size: 2.5em; font-weight: bold;">{% if risk_breakdown and risk_breakdown.cvss_analysis %}{{ risk_breakdown.cvss_analysis.average_cvss_score }}{% else %}N/A{% endif %}</div>
                <div style="color: #8B949E; font-size: 0.8em; margin-top: 5px;">CVSS v3.1</div>
            </div>
            <div style="background: rgba(255, 0, 60, 0.1); padding: 20px; border-radius: 10px; border: 1px solid rgba(255, 0, 60, 0.3);">
                <div style="color: #8B949E; font-size: 0.85em; margin-bottom: 5px;">Attack Chains</div>
                <div style="color: #FF003C; font-size: 2.5em; font-weight: bold;">{% if risk_breakdown and risk_breakdown.attack_chains %}{{ risk_breakdown.attack_chains.detected_count }}{% else %}0{% endif %}</div>
                <div style="color: #8B949E; font-size: 0.8em; margin-top: 5px;">{% if risk_breakdown and risk_breakdown.attack_chains %}{{ risk_breakdown.attack_chains.critical_chains }} Critical{% else %}None{% endif %}</div>
            </div>
        </div>

        <!-- CVSS Analysis Chart -->
        <div style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
            <h4 style="color: #FFD700; margin-bottom: 15px;">CVSS v3.1 Vulnerability Distribution</h4>
            <div style="display: grid; gap: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #FF003C; font-weight: bold; min-width: 80px;">Critical</span>
                    <div style="flex: 1; margin: 0 15px; background: rgba(139, 148, 158, 0.2); border-radius: 10px; height: 10px; overflow: hidden;">
                        <div style="width: {% if risk_breakdown and risk_breakdown.cvss_analysis %}{{ risk_breakdown.cvss_analysis.critical_count|add:0 }}{% else %}0{% endif %}%; background: linear-gradient(90deg, #FF003C, #FF1744); height: 100%;"></div>
                    </div>
                    <span style="color: #FF003C; font-weight: bold; min-width: 30px; text-align: right;">{% if risk_breakdown and risk_breakdown.cvss_analysis %}{{ risk_breakdown.cvss_analysis.critical_count }}{% else %}0{% endif %}</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #FF6A00; font-weight: bold; min-width: 80px;">High</span>
                    <div style="flex: 1; margin: 0 15px; background: rgba(139, 148, 158, 0.2); border-radius: 10px; height: 10px; overflow: hidden;">
                        <div style="width: {% if risk_breakdown and risk_breakdown.cvss_analysis %}{{ risk_breakdown.cvss_analysis.high_count|add:0 }}{% else %}0{% endif %}%; background: linear-gradient(90deg, #FF6A00, #FF8C00); height: 100%;"></div>
                    </div>
                    <span style="color: #FF6A00; font-weight: bold; min-width: 30px; text-align: right;">{% if risk_breakdown and risk_breakdown.cvss_analysis %}{{ risk_breakdown.cvss_analysis.high_count }}{% else %}0{% endif %}</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #FFD700; font-weight: bold; min-width: 80px;">Medium</span>
                    <div style="flex: 1; margin: 0 15px; background: rgba(139, 148, 158, 0.2); border-radius: 10px; height: 10px; overflow: hidden;">
                        <div style="width: {% if risk_breakdown and risk_breakdown.cvss_analysis %}{{ risk_breakdown.cvss_analysis.medium_count|add:0 }}{% else %}0{% endif %}%; background: linear-gradient(90deg, #FFD700, #FFA500); height: 100%;"></div>
                    </div>
                    <span style="color: #FFD700; font-weight: bold; min-width: 30px; text-align: right;">{% if risk_breakdown and risk_breakdown.cvss_analysis %}{{ risk_breakdown.cvss_analysis.medium_count }}{% else %}0{% endif %}</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #00BFFF; font-weight: bold; min-width: 80px;">Low</span>
                    <div style="flex: 1; margin: 0 15px; background: rgba(139, 148, 158, 0.2); border-radius: 10px; height: 10px; overflow: hidden;">
                        <div style="width: {% if risk_breakdown and risk_breakdown.cvss_analysis %}{{ risk_breakdown.cvss_analysis.low_count|add:0 }}{% else %}0{% endif %}%; background: linear-gradient(90deg, #00BFFF, #00CED1); height: 100%;"></div>
                    </div>
                    <span style="color: #00BFFF; font-weight: bold; min-width: 30px; text-align: right;">{% if risk_breakdown and risk_breakdown.cvss_analysis %}{{ risk_breakdown.cvss_analysis.low_count }}{% else %}0{% endif %}</span>
                </div>
            </div>
        </div>

        <!-- AI Predictions -->
        <div style="background: rgba(186, 85, 211, 0.1); padding: 20px; border-radius: 10px;">
            <h4 style="color: #BA55D3; margin-bottom: 15px;">ü§ñ AI-Based Risk Predictions</h4>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                <div style="text-align: center; padding: 15px; background: rgba(255, 0, 60, 0.1); border-radius: 8px;">
                    <div style="color: #8B949E; font-size: 0.75em; margin-bottom: 5px;">IMMEDIATE</div>
                    <div style="color: #FF003C; font-size: 2em; font-weight: bold;">{% if risk_breakdown and risk_breakdown.ai_predictions %}{{ risk_breakdown.ai_predictions.immediate_priority_count }}{% else %}0{% endif %}</div>
                </div>
                <div style="text-align: center; padding: 15px; background: rgba(255, 106, 0, 0.1); border-radius: 8px;">
                    <div style="color: #8B949E; font-size: 0.75em; margin-bottom: 5px;">URGENT</div>
                    <div style="color: #FF6A00; font-size: 2em; font-weight: bold;">{% if risk_breakdown and risk_breakdown.ai_predictions %}{{ risk_breakdown.ai_predictions.urgent_priority_count }}{% else %}0{% endif %}</div>
                </div>
                <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 8px;">
                    <div style="color: #8B949E; font-size: 0.75em; margin-bottom: 5px;">HIGH</div>
                    <div style="color: #FFD700; font-size: 2em; font-weight: bold;">{% if risk_breakdown and risk_breakdown.ai_predictions %}{{ risk_breakdown.ai_predictions.high_priority_count }}{% else %}0{% endif %}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Attack Chains -->
    {% if risk_breakdown and risk_breakdown.attack_chains and risk_breakdown.attack_chains.chains %}
    <div style="background: #0D1117; border-radius: 10px; padding: 25px; border: 1px solid rgba(255, 0, 60, 0.2); margin-bottom: 20px;">
        <h4 style="color: #FF003C; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FF003C" stroke-width="2">
                <circle cx="5" cy="12" r="1"></circle>
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="19" cy="12" r="1"></circle>
            </svg>
            üîó Attack Chains Detected ({% if risk_breakdown and risk_breakdown.attack_chains %}{{ risk_breakdown.attack_chains.detected_count }}{% else %}0{% endif %})
        </h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(450px, 1fr)); gap: 15px;">
            {% for chain in risk_breakdown.attack_chains.chains|slice:":5" %}
            {% if chain.severity == 'Critical' %}
            <div style="background: rgba(255, 0, 60, 0.05); border-radius: 8px; padding: 20px; border-left: 4px solid #FF003C;">
            {% elif chain.severity == 'High' %}
            <div style="background: rgba(255, 0, 60, 0.05); border-radius: 8px; padding: 20px; border-left: 4px solid #FF6A00;">
            {% else %}
            <div style="background: rgba(255, 0, 60, 0.05); border-radius: 8px; padding: 20px; border-left: 4px solid #FFD700;">
            {% endif %}
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                    <h5 style="color: #E6EDF3; margin: 0; flex: 1;">{{ chain.chain_name }}</h5>
                    <span class="badge {{ chain.severity|lower }}" style="margin-left: 10px;">{{ chain.severity|upper }}</span>
                </div>
                <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 12px;">{{ chain.description }}</div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 12px;">
                    <div>
                        <div style="color: #8B949E; font-size: 0.75em;">Risk Multiplier</div>
                        <div style="color: #FF6A00; font-weight: bold;">{{ chain.risk_multiplier }}x</div>
                    </div>
                    <div>
                        <div style="color: #8B949E; font-size: 0.75em;">Base Risk</div>
                        <div style="color: #FFD700; font-weight: bold;">{{ chain.base_risk_score }}</div>
                    </div>
                    <div>
                        <div style="color: #8B949E; font-size: 0.75em;">Amplified</div>
                        <div style="color: #FF003C; font-weight: bold;">{{ chain.amplified_risk_score }}</div>
                    </div>
                </div>
                <div style="background: rgba(0, 191, 255, 0.1); padding: 10px; border-radius: 6px; border-left: 3px solid #00BFFF;">
                    <div style="color: #00BFFF; font-weight: bold; font-size: 0.85em; margin-bottom: 5px;">Attack Scenario:</div>
                    <div style="color: #E6EDF3; font-size: 0.85em;">{{ chain.attack_scenario }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Top Risks -->
    {% if risk_breakdown and risk_breakdown.top_risks %}
    <div style="background: #0D1117; border-radius: 10px; padding: 25px; border: 1px solid rgba(0, 255, 156, 0.2);">
        <h4 style="color: #00FF9C; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#00FF9C" stroke-width="2">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            üéØ Top Priority Risks
        </h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 15px;">
            {% for risk in risk_breakdown.top_risks %}
            {% if risk.priority == 'Critical' %}
            <div style="background: rgba(0, 255, 156, 0.02); border-radius: 8px; padding: 18px; border-left: 4px solid #FF003C;">
            {% elif risk.priority == 'Urgent' %}
            <div style="background: rgba(0, 255, 156, 0.02); border-radius: 8px; padding: 18px; border-left: 4px solid #FF6A00;">
            {% elif risk.priority == 'High' %}
            <div style="background: rgba(0, 255, 156, 0.02); border-radius: 8px; padding: 18px; border-left: 4px solid #FFD700;">
            {% else %}
            <div style="background: rgba(0, 255, 156, 0.02); border-radius: 8px; padding: 18px; border-left: 4px solid #00BFFF;">
            {% endif %}
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                    <h5 style="color: #E6EDF3; margin: 0; flex: 1;">{{ risk.type }}</h5>
                    {% if risk.priority == 'Critical' %}
                    <span class="badge critical" style="font-size: 0.7em; margin-left: 10px;">{{ risk.priority|upper }}</span>
                    {% elif risk.priority == 'Urgent' %}
                    <span class="badge high" style="font-size: 0.7em; margin-left: 10px;">{{ risk.priority|upper }}</span>
                    {% elif risk.priority == 'High' %}
                    <span class="badge medium" style="font-size: 0.7em; margin-left: 10px;">{{ risk.priority|upper }}</span>
                    {% else %}
                    <span class="badge low" style="font-size: 0.7em; margin-left: 10px;">{{ risk.priority|upper }}</span>
                    {% endif %}
                </div>
                <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                    <div>
                        <div style="color: #8B949E; font-size: 0.75em;">CVSS Score</div>
                        <div style="color: #FFD700; font-weight: bold; font-size: 1.1em;">{{ risk.cvss_score }}/10</div>
                    </div>
                    <div>
                        <div style="color: #8B949E; font-size: 0.75em;">AI Predicted</div>
                        <div style="color: #BA55D3; font-weight: bold; font-size: 1.1em;">{{ risk.predicted_score }}/10</div>
                    </div>
                </div>
                <div style="color: #8B949E; font-size: 0.85em; line-height: 1.5;">{{ risk.recommendation|truncatewords:20 }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    {% endif %}

    <!-- Open Ports Table -->
    <div style="background: #161B22; border-radius: 12px; padding: 30px; border: 1px solid rgba(0, 255, 156, 0.2); margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="color: #00FF9C; margin: 0;">Open Ports ({{ ports.count }})</h3>
            <input type="text" id="port-search" placeholder="Search ports..." style="padding: 10px 15px; background: #0D1117; border: 2px solid rgba(0, 255, 156, 0.3); border-radius: 8px; color: #E6EDF3; width: 300px;">
        </div>

        {% if ports %}
        <table id="ports-table" style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: rgba(0, 255, 156, 0.1);">
                    <th style="padding: 15px; text-align: left; color: #00FF9C; border-bottom: 2px solid rgba(0, 255, 156, 0.3);">Port</th>
                    <th style="padding: 15px; text-align: left; color: #00FF9C; border-bottom: 2px solid rgba(0, 255, 156, 0.3);">Service</th>
                    <th style="padding: 15px; text-align: left; color: #00FF9C; border-bottom: 2px solid rgba(0, 255, 156, 0.3);">Version</th>
                    <th style="padding: 15px; text-align: left; color: #00FF9C; border-bottom: 2px solid rgba(0, 255, 156, 0.3);">Protocol</th>
                    <th style="padding: 15px; text-align: left; color: #00FF9C; border-bottom: 2px solid rgba(0, 255, 156, 0.3);">Risk Level</th>
                </tr>
            </thead>
            <tbody>
                {% for port in ports %}
                <tr class="port-row" style="border-bottom: 1px solid rgba(139, 148, 158, 0.2);">
                    <td style="padding: 15px;"><strong style="color: #00BFFF;">{{ port.port_number }}</strong></td>
                    <td style="padding: 15px; color: #E6EDF3;">{{ port.service|default:"Unknown" }}</td>
                    <td style="padding: 15px; color: #8B949E; font-size: 0.9em;">{{ port.version|truncatewords:10|default:"N/A" }}</td>
                    <td style="padding: 15px;"><span class="badge low">{{ port.protocol|upper }}</span></td>
                    <td style="padding: 15px;">
                        {% if port.port_number == 21 or port.port_number == 23 or port.port_number == 445 or port.port_number == 3389 or port.port_number == 5900 %}
                        <span class="badge critical">HIGH RISK</span>
                        {% elif port.port_number == 22 or port.port_number == 80 or port.port_number == 443 or port.port_number == 3306 or port.port_number == 5432 %}
                        <span class="badge medium">MEDIUM</span>
                        {% else %}
                        <span class="badge low">LOW</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div style="text-align: center; padding: 40px; color: #8B949E;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#8B949E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 10px;">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <p>No open ports discovered</p>
        </div>
        {% endif %}
    </div>

    <!-- Vulnerabilities Panel -->
    <div style="background: #161B22; border-radius: 12px; padding: 30px; border: 1px solid rgba(255, 106, 0, 0.2); margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="color: #FF6A00; margin: 0;">Vulnerabilities ({{ vulnerabilities.count }})</h3>
            <div style="display: flex; gap: 10px;">
                <select id="severity-filter" style="padding: 8px 12px; background: #0D1117; border: 2px solid rgba(255, 106, 0, 0.3); border-radius: 6px; color: #E6EDF3;">
                    <option value="">All Severities</option>
                    <option value="critical">Critical</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
                <input type="text" id="vuln-search" placeholder="Search vulnerabilities..." style="padding: 8px 12px; background: #0D1117; border: 2px solid rgba(255, 106, 0, 0.3); border-radius: 6px; color: #E6EDF3; width: 250px;">
            </div>
        </div>

        {% if vulnerabilities %}
        <div id="vulnerabilities-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 20px;">
            {% for vuln in vulnerabilities %}
            <div class="vuln-card" data-severity="{{ vuln.severity }}" style="background: #0D1117; border-radius: 8px; padding: 20px; border-left: 4px solid {% if vuln.severity == 'critical' %}#FF003C{% elif vuln.severity == 'high' %}#FF6A00{% elif vuln.severity == 'medium' %}#FFD700{% else %}#00BFFF{% endif %}; transition: all 0.3s;">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                    <h4 style="color: #E6EDF3; margin: 0; flex: 1;">{{ vuln.title }}</h4>
                    <span class="badge {{ vuln.severity }}" style="margin-left: 10px;">{{ vuln.severity|upper }}</span>
                </div>

                <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 10px;">
                    {% if vuln.port %}Port: <span style="color: #00BFFF;">{{ vuln.port.port_number }}</span> ‚Ä¢ {% endif %}
                    {% if vuln.cvss_score %}CVSS: <span style="color: #FFD700;">{{ vuln.cvss_score }}</span>{% endif %}
                    {% if vuln.cve_id %} ‚Ä¢ CVE: <span style="color: #FF6A00;">{{ vuln.cve_id }}</span>{% endif %}
                </div>

                <div style="color: #E6EDF3; font-size: 0.9em; line-height: 1.5; margin-bottom: 15px;">
                    {{ vuln.description|truncatewords:30 }}
                </div>

                {% if vuln.remediation %}
                <div style="background: rgba(0, 255, 156, 0.1); padding: 15px; border-radius: 6px; border-left: 3px solid #00FF9C;">
                    <div style="color: #00FF9C; font-weight: bold; font-size: 0.85em; margin-bottom: 5px;">Remediation:</div>
                    <div style="color: #E6EDF3; font-size: 0.85em;">{{ vuln.remediation|truncatewords:20 }}</div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 40px; color: #8B949E;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#00FF9C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 10px;">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22,4 12,14.01 9,11.01"></polyline>
            </svg>
            <p>No vulnerabilities found. Target appears secure.</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75em;
    font-weight: bold;
    text-transform: uppercase;
}
.badge.critical { background: #FF003C; color: white; }
.badge.high { background: #FF6A00; color: white; }
.badge.medium { background: #FFD700; color: black; }
.badge.low { background: #00FF9C; color: black; }

.port-row:hover {
    background: rgba(0, 255, 156, 0.05);
}

.vuln-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

#ports-table th {
    position: sticky;
    top: 0;
    background: #161B22;
}
</style>

<script>
// Port search functionality
document.getElementById('port-search').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('.port-row');
    
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
});

// Vulnerability search and filter
document.getElementById('vuln-search').addEventListener('input', filterVulnerabilities);
document.getElementById('severity-filter').addEventListener('change', filterVulnerabilities);

function filterVulnerabilities() {
    const searchTerm = document.getElementById('vuln-search').value.toLowerCase();
    const severityFilter = document.getElementById('severity-filter').value;
    const cards = document.querySelectorAll('.vuln-card');
    
    cards.forEach(card => {
        const text = card.textContent.toLowerCase();
        const severity = card.dataset.severity;
        
        const matchesSearch = text.includes(searchTerm);
        const matchesSeverity = !severityFilter || severity === severityFilter;
        
        card.style.display = matchesSearch && matchesSeverity ? '' : 'none';
    });
}
</script>
{% endblock %}