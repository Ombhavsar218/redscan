{% extends 'rescanai/base.html' %}

{% block title %}Scan Results - #{{ scan.id }}{% endblock %}

{% block content %}
<div style="max-width: 100%; margin: 0;">
    <!-- üî¥ 1. Scan Summary Header (Top Section) -->
    <div style="background: linear-gradient(135deg, #0D1117 0%, #161B22 100%); border-radius: 16px; padding: 40px; margin-bottom: 30px; border: 2px solid rgba(0, 255, 156, 0.3); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h1 style="color: #00FF9C; margin: 0; font-size: 2.5em; font-weight: 700; display: flex; align-items: center; gap: 12px;">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
                Security Scan Report
            </h1>
            <a href="{% url 'rescanai:index' %}" style="color: #8B949E; text-decoration: none; font-size: 1.1em;">‚Üê Back to Dashboard</a>
        </div>
        
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 30px; align-items: center;">
            <!-- Target Info -->
            <div>
                <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="6" x2="12" y2="12"></line>
                        <line x1="16" y1="12" x2="12" y2="12"></line>
                    </svg>
                    TARGET SCANNED
                </div>
                <div style="color: #00BFFF; font-size: 1.8em; font-weight: bold; margin-bottom: 5px;">{{ scan.target.target_value }}</div>
                <div style="color: #E6EDF3; font-size: 1em; margin-bottom: 3px;">{{ scan.target.name }}</div>
                <div style="color: #8B949E; font-size: 0.85em; display: flex; align-items: center; gap: 6px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    {{ scan.started_at|date:"M d, Y H:i" }}
                    {% if scan.completed_at %} - {{ scan.completed_at|date:"H:i" }}{% endif %}
                </div>
                <div style="color: #8B949E; font-size: 0.85em; display: flex; align-items: center; gap: 6px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12,6 12,12 16,14"></polyline>
                    </svg>
                    Scan Type: <span style="color: #FFD700;">{{ scan.scan_type|upper }}</span>
                </div>
            </div>
            
            <!-- Risk Score Circle -->
            <div style="text-align: center;">
                <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 10px;">OVERALL RISK SCORE</div>
                <div style="position: relative; width: 120px; height: 120px; margin: 0 auto;">
                    <svg width="120" height="120" style="transform: rotate(-90deg);">
                        <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(139, 148, 158, 0.2)" stroke-width="8"/>
                        <circle cx="60" cy="60" r="50" fill="none" 
                                stroke="{% if scan.risk_score >= 7 %}#FF003C{% elif scan.risk_score >= 4 %}#FFD700{% else %}#00FF9C{% endif %}" 
                                stroke-width="8" 
                                stroke-dasharray="314" 
                                stroke-dashoffset="200"
                                stroke-linecap="round"/>
                    </svg>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                        <div style="color: {% if scan.risk_score >= 7 %}#FF003C{% elif scan.risk_score >= 4 %}#FFD700{% else %}#00FF9C{% endif %}; font-size: 1.8em; font-weight: bold;">
                            {% if scan.risk_score > 0 %}{{ scan.risk_score|floatformat:0 }}{% else %}N/A{% endif %}
                        </div>
                        <div style="color: #8B949E; font-size: 0.7em;">/ 100</div>
                    </div>
                </div>
            </div>
            
            <!-- Security Grade -->
            <div style="text-align: center;">
                <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 10px;">SECURITY GRADE</div>
                <div style="width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto; font-size: 2.5em; font-weight: bold;
                            {% if scan.risk_score >= 8 %}background: linear-gradient(135deg, #FF003C, #FF1744); color: white;
                            {% elif scan.risk_score >= 6 %}background: linear-gradient(135deg, #FF6A00, #FF8C00); color: white;
                            {% elif scan.risk_score >= 4 %}background: linear-gradient(135deg, #FFD700, #FFA500); color: black;
                            {% elif scan.risk_score >= 2 %}background: linear-gradient(135deg, #00BFFF, #00CED1); color: white;
                            {% else %}background: linear-gradient(135deg, #00FF9C, #00E676); color: black;{% endif %};">
                    {% if scan.risk_score >= 8 %}F{% elif scan.risk_score >= 6 %}D{% elif scan.risk_score >= 4 %}C{% elif scan.risk_score >= 2 %}B{% else %}A{% endif %}
                </div>
            </div>
            
            <!-- Risk Badge -->
            <div style="text-align: center;">
                <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 10px;">RISK LEVEL</div>
                <div style="padding: 15px 20px; border-radius: 25px; font-weight: bold; font-size: 1.1em;
                            {% if scan.risk_score >= 7 %}background: linear-gradient(135deg, #FF003C, #FF1744); color: white;
                            {% elif scan.risk_score >= 4 %}background: linear-gradient(135deg, #FFD700, #FFA500); color: black;
                            {% else %}background: linear-gradient(135deg, #00FF9C, #00E676); color: black;{% endif %};">
                    {% if scan.risk_score >= 7 %}HIGH RISK{% elif scan.risk_score >= 4 %}MEDIUM RISK{% else %}LOW RISK{% endif %}
                </div>
            </div>
        </div>
    </div>   
 <!-- üìä 2. Vulnerability Overview Dashboard -->
    <div style="background: #161B22; border-radius: 16px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255, 106, 0, 0.3);">
        <h2 style="color: #FF6A00; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
            üìä Vulnerability Overview Dashboard
        </h2>
        
        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px;">
            <!-- Severity Breakdown Cards -->
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                <div class="severity-card" data-severity="critical" style="background: rgba(255, 0, 60, 0.1); border: 2px solid #FF003C; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s;">
                    <div style="color: #FF003C; font-size: 2.5em; font-weight: bold;">{{ severity_counts.critical }}</div>
                    <div style="color: #FF003C; font-weight: bold; margin-top: 5px;">CRITICAL</div>
                </div>
                <div class="severity-card" data-severity="high" style="background: rgba(255, 106, 0, 0.1); border: 2px solid #FF6A00; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s;">
                    <div style="color: #FF6A00; font-size: 2.5em; font-weight: bold;">{{ severity_counts.high }}</div>
                    <div style="color: #FF6A00; font-weight: bold; margin-top: 5px;">HIGH</div>
                </div>
                <div class="severity-card" data-severity="medium" style="background: rgba(255, 215, 0, 0.1); border: 2px solid #FFD700; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s;">
                    <div style="color: #FFD700; font-size: 2.5em; font-weight: bold;">{{ severity_counts.medium }}</div>
                    <div style="color: #FFD700; font-weight: bold; margin-top: 5px;">MEDIUM</div>
                </div>
                <div class="severity-card" data-severity="low" style="background: rgba(0, 191, 255, 0.1); border: 2px solid #00BFFF; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s;">
                    <div style="color: #00BFFF; font-size: 2.5em; font-weight: bold;">{{ severity_counts.low }}</div>
                    <div style="color: #00BFFF; font-weight: bold; margin-top: 5px;">LOW</div>
                </div>
            </div>
            
            <!-- Visual Chart -->
            <div style="background: rgba(0, 0, 0, 0.2); border-radius: 12px; padding: 25px;">
                <h4 style="color: #E6EDF3; margin-bottom: 20px;">Severity Distribution</h4>
                <div style="display: grid; gap: 12px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="color: #FF003C; font-weight: bold; min-width: 80px;">Critical</span>
                        <div style="flex: 1; background: rgba(139, 148, 158, 0.2); border-radius: 10px; height: 12px; overflow: hidden;">
                            <div style="width: {% if vulnerabilities.count > 0 %}{% widthratio severity_counts.critical vulnerabilities.count 100 %}{% else %}0{% endif %}%; background: linear-gradient(90deg, #FF003C, #FF1744); height: 100%; transition: width 1s ease;"></div>
                        </div>
                        <span style="color: #FF003C; font-weight: bold; min-width: 40px;">{{ severity_counts.critical }}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="color: #FF6A00; font-weight: bold; min-width: 80px;">High</span>
                        <div style="flex: 1; background: rgba(139, 148, 158, 0.2); border-radius: 10px; height: 12px; overflow: hidden;">
                            <div style="width: {% if vulnerabilities.count > 0 %}{% widthratio severity_counts.high vulnerabilities.count 100 %}{% else %}0{% endif %}%; background: linear-gradient(90deg, #FF6A00, #FF8C00); height: 100%; transition: width 1s ease;"></div>
                        </div>
                        <span style="color: #FF6A00; font-weight: bold; min-width: 40px;">{{ severity_counts.high }}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="color: #FFD700; font-weight: bold; min-width: 80px;">Medium</span>
                        <div style="flex: 1; background: rgba(139, 148, 158, 0.2); border-radius: 10px; height: 12px; overflow: hidden;">
                            <div style="width: {% if vulnerabilities.count > 0 %}{% widthratio severity_counts.medium vulnerabilities.count 100 %}{% else %}0{% endif %}%; background: linear-gradient(90deg, #FFD700, #FFA500); height: 100%; transition: width 1s ease;"></div>
                        </div>
                        <span style="color: #FFD700; font-weight: bold; min-width: 40px;">{{ severity_counts.medium }}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="color: #00BFFF; font-weight: bold; min-width: 80px;">Low</span>
                        <div style="flex: 1; background: rgba(139, 148, 158, 0.2); border-radius: 10px; height: 12px; overflow: hidden;">
                            <div style="width: {% if vulnerabilities.count > 0 %}{% widthratio severity_counts.low vulnerabilities.count 100 %}{% else %}0{% endif %}%; background: linear-gradient(90deg, #00BFFF, #00CED1); height: 100%; transition: width 1s ease;"></div>
                        </div>
                        <span style="color: #00BFFF; font-weight: bold; min-width: 40px;">{{ severity_counts.low }}</span>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(139, 148, 158, 0.2);">
                    <span style="color: #E6EDF3; font-size: 1.2em; font-weight: bold;">Total: {{ vulnerabilities.count }} Vulnerabilities</span>
                </div>
            </div>
        </div>
    </div>    <
!-- üîç 3. Open Ports & Services Section -->
    <div style="background: #161B22; border-radius: 16px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(0, 255, 156, 0.3);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <h2 style="color: #00FF9C; margin: 0; display: flex; align-items: center; gap: 10px;">
                üîç Open Ports & Services ({{ ports.count }})
            </h2>
            <input type="text" id="port-search" placeholder="üîç Search ports..." 
                   style="padding: 12px 20px; background: #0D1117; border: 2px solid rgba(0, 255, 156, 0.3); border-radius: 25px; color: #E6EDF3; width: 300px; font-size: 0.9em;">
        </div>

        {% if ports %}
        <div style="overflow-x: auto; border-radius: 12px; border: 1px solid rgba(0, 255, 156, 0.2);">
            <table id="ports-table" style="width: 100%; border-collapse: collapse; background: #0D1117;">
                <thead>
                    <tr style="background: linear-gradient(135deg, rgba(0, 255, 156, 0.1), rgba(0, 255, 156, 0.05));">
                        <th style="padding: 18px; text-align: left; color: #00FF9C; font-weight: bold; border-bottom: 2px solid rgba(0, 255, 156, 0.3);">üîå Port</th>
                        <th style="padding: 18px; text-align: left; color: #00FF9C; font-weight: bold; border-bottom: 2px solid rgba(0, 255, 156, 0.3);">üì° Protocol</th>
                        <th style="padding: 18px; text-align: left; color: #00FF9C; font-weight: bold; border-bottom: 2px solid rgba(0, 255, 156, 0.3);">‚öôÔ∏è Service</th>
                        <th style="padding: 18px; text-align: left; color: #00FF9C; font-weight: bold; border-bottom: 2px solid rgba(0, 255, 156, 0.3);">üè∑Ô∏è Version</th>
                        <th style="padding: 18px; text-align: left; color: #00FF9C; font-weight: bold; border-bottom: 2px solid rgba(0, 255, 156, 0.3);">üö® Status</th>
                        <th style="padding: 18px; text-align: left; color: #00FF9C; font-weight: bold; border-bottom: 2px solid rgba(0, 255, 156, 0.3);">‚ö†Ô∏è Risk Level</th>
                    </tr>
                </thead>
                <tbody>
                    {% for port in ports %}
                    <tr class="port-row" style="border-bottom: 1px solid rgba(139, 148, 158, 0.1); transition: all 0.3s;">
                        <td style="padding: 15px;"><strong style="color: #00BFFF; font-size: 1.1em;">{{ port.port_number }}</strong></td>
                        <td style="padding: 15px; color: #E6EDF3;">{{ port.protocol|upper }}</td>
                        <td style="padding: 15px; color: #E6EDF3; font-weight: 500;">{{ port.service|default:"Unknown" }}</td>
                        <td style="padding: 15px; color: #8B949E; font-size: 0.9em;">{{ port.version|truncatewords:8|default:"N/A" }}</td>
                        <td style="padding: 15px;"><span style="background: #00FF9C; color: black; padding: 4px 12px; border-radius: 15px; font-size: 0.8em; font-weight: bold;">‚úÖ OPEN</span></td>
                        <td style="padding: 15px;">
                            {% if port.port_number == 21 or port.port_number == 23 or port.port_number == 445 or port.port_number == 3389 or port.port_number == 5900 %}
                            <span style="background: #FF003C; color: white; padding: 6px 12px; border-radius: 15px; font-size: 0.8em; font-weight: bold;">HIGH RISK</span>
                            {% elif port.port_number == 22 or port.port_number == 80 or port.port_number == 443 or port.port_number == 3306 or port.port_number == 5432 %}
                            <span style="background: #FFD700; color: black; padding: 6px 12px; border-radius: 15px; font-size: 0.8em; font-weight: bold;">MEDIUM</span>
                            {% else %}
                            <span style="background: #00FF9C; color: black; padding: 6px 12px; border-radius: 15px; font-size: 0.8em; font-weight: bold;">üü¢ LOW</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 60px; color: #8B949E; background: rgba(0, 0, 0, 0.2); border-radius: 12px;">
            <div style="font-size: 4em; margin-bottom: 15px;">üîí</div>
            <h3 style="color: #00FF9C; margin-bottom: 10px;">No Open Ports Discovered</h3>
            <p>All ports appear to be closed or filtered. This is generally a good security posture.</p>
        </div>
        {% endif %}
    </div>    
<!-- üåê 4. Web Vulnerabilities Section -->
    {% if vulnerabilities %}
    <div style="background: #161B22; border-radius: 16px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255, 106, 0, 0.3);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <h2 style="color: #FF6A00; margin: 0; display: flex; align-items: center; gap: 10px;">
                üåê Web Vulnerabilities & Security Issues
            </h2>
            <div style="display: flex; gap: 15px;">
                <select id="severity-filter" style="padding: 10px 15px; background: #0D1117; border: 2px solid rgba(255, 106, 0, 0.3); border-radius: 20px; color: #E6EDF3; font-size: 0.9em;">
                    <option value="">All Severities</option>
                    <option value="critical">Critical</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">üü¢ Low</option>
                </select>
                <input type="text" id="vuln-search" placeholder="üîç Search vulnerabilities..." 
                       style="padding: 10px 20px; background: #0D1117; border: 2px solid rgba(255, 106, 0, 0.3); border-radius: 20px; color: #E6EDF3; width: 300px; font-size: 0.9em;">
            </div>
        </div>

        <div id="vulnerabilities-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(450px, 1fr)); gap: 20px;">
            {% for vuln in vulnerabilities %}
            <div class="vuln-card" data-severity="{{ vuln.severity }}" 
                 style="background: linear-gradient(135deg, #0D1117, #161B22); border-radius: 12px; padding: 25px; 
                        border-left: 5px solid {% if vuln.severity == 'critical' %}#FF003C{% elif vuln.severity == 'high' %}#FF6A00{% elif vuln.severity == 'medium' %}#FFD700{% else %}#00BFFF{% endif %}; 
                        border: 1px solid {% if vuln.severity == 'critical' %}rgba(255, 0, 60, 0.3){% elif vuln.severity == 'high' %}rgba(255, 106, 0, 0.3){% elif vuln.severity == 'medium' %}rgba(255, 215, 0, 0.3){% else %}rgba(0, 191, 255, 0.3){% endif %}; 
                        transition: all 0.3s; cursor: pointer;">
                
                <!-- Vulnerability Header -->
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                    <h3 style="color: #E6EDF3; margin: 0; flex: 1; font-size: 1.2em; font-weight: 600;">
                        {{ vuln.title }}
                    </h3>
                    <span style="background: {% if vuln.severity == 'critical' %}#FF003C{% elif vuln.severity == 'high' %}#FF6A00{% elif vuln.severity == 'medium' %}#FFD700{% else %}#00BFFF{% endif %}; 
                                 color: {% if vuln.severity == 'medium' %}black{% else %}white{% endif %}; 
                                 padding: 6px 12px; border-radius: 15px; font-size: 0.8em; font-weight: bold; margin-left: 15px;">
                        {{ vuln.severity|upper }}
                    </span>
                </div>

                <!-- Vulnerability Details -->
                <div style="color: #8B949E; font-size: 0.9em; margin-bottom: 15px; display: flex; flex-wrap: gap: 15px;">
                    {% if vuln.port %}
                    <span>üîå Port: <strong style="color: #00BFFF;">{{ vuln.port.port_number }}</strong></span>
                    {% endif %}
                    {% if vuln.cvss_score %}
                    <span>üìä CVSS: <strong style="color: #FFD700;">{{ vuln.cvss_score }}</strong></span>
                    {% endif %}
                    {% if vuln.cve_id %}
                    <span>üÜî CVE: <strong style="color: #FF6A00;">{{ vuln.cve_id }}</strong></span>
                    {% endif %}
                </div>

                <!-- Description -->
                <div style="color: #E6EDF3; font-size: 0.95em; line-height: 1.6; margin-bottom: 20px; background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                    {{ vuln.description|truncatewords:40 }}
                </div>

                <!-- Remediation -->
                {% if vuln.remediation %}
                <div style="background: linear-gradient(135deg, rgba(0, 255, 156, 0.1), rgba(0, 255, 156, 0.05)); padding: 15px; border-radius: 8px; border-left: 3px solid #00FF9C;">
                    <div style="color: #00FF9C; font-weight: bold; font-size: 0.85em; margin-bottom: 8px; display: flex; align-items: center; gap: 5px;">
                        üõ†Ô∏è RECOMMENDED FIX:
                    </div>
                    <div style="color: #E6EDF3; font-size: 0.9em; line-height: 1.5;">{{ vuln.remediation|truncatewords:25 }}</div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}   
 <!-- üìà 6. Risk Score & Recommendations Panel -->
    <div style="background: linear-gradient(135deg, #161B22, #1C2128); border-radius: 16px; padding: 35px; margin-bottom: 30px; border: 2px solid rgba(186, 85, 211, 0.4); box-shadow: 0 8px 32px rgba(186, 85, 211, 0.1);">
        <h2 style="color: #BA55D3; margin-bottom: 30px; display: flex; align-items: center; gap: 10px; font-size: 1.8em;">
            üìà Risk Assessment & Security Recommendations
        </h2>
        
        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 35px;">
            <!-- Risk Metrics -->
            <div>
                <div style="background: rgba(186, 85, 211, 0.1); border-radius: 12px; padding: 25px; margin-bottom: 25px;">
                    <h3 style="color: #BA55D3; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="6" x2="12" y2="12"></line>
                            <line x1="16" y1="12" x2="12" y2="12"></line>
                        </svg>
                        Overall Security Score
                    </h3>
                    <div style="text-align: center;">
                        <div style="font-size: 3.5em; font-weight: bold; color: {% if scan.risk_score >= 7 %}#FF003C{% elif scan.risk_score >= 4 %}#FFD700{% else %}#00FF9C{% endif %}; margin-bottom: 10px;">
                            {% if scan.risk_score > 0 %}{{ scan.risk_score|floatformat:0 }}{% else %}N/A{% endif %}/100
                        </div>
                        <div style="color: #8B949E; font-size: 1.1em;">
                            {% if scan.risk_score >= 8 %}Critical Risk{% elif scan.risk_score >= 6 %}High Risk{% elif scan.risk_score >= 4 %}Medium Risk{% elif scan.risk_score >= 2 %}Low Risk{% else %}Minimal Risk{% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: rgba(255, 0, 60, 0.1); border-radius: 8px; padding: 15px; text-align: center;">
                        <div style="color: #FF003C; font-size: 1.8em; font-weight: bold;">{{ severity_counts.critical|add:severity_counts.high }}</div>
                        <div style="color: #FF003C; font-size: 0.8em; font-weight: bold;">URGENT ISSUES</div>
                    </div>
                    <div style="background: rgba(0, 255, 156, 0.1); border-radius: 8px; padding: 15px; text-align: center;">
                        <div style="color: #00FF9C; font-size: 1.8em; font-weight: bold;">{{ ports.count }}</div>
                        <div style="color: #00FF9C; font-size: 0.8em; font-weight: bold;">OPEN PORTS</div>
                    </div>
                </div>
            </div>
            
            <!-- Priority Actions -->
            <div>
                <h3 style="color: #FFD700; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                    üö® Priority Actions Required
                </h3>
                
                <div style="display: grid; gap: 15px;">
                    {% if severity_counts.critical > 0 %}
                    <div style="background: rgba(255, 0, 60, 0.1); border-left: 4px solid #FF003C; border-radius: 8px; padding: 20px;">
                        <div style="color: #FF003C; font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                            1. Address Critical Vulnerabilities
                        </div>
                        <div style="color: #E6EDF3; font-size: 0.9em; line-height: 1.5;">
                            {{ severity_counts.critical }} critical issue{{ severity_counts.critical|pluralize }} found that require immediate attention. These pose severe security risks.
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if ports.count > 10 %}
                    <div style="background: rgba(255, 215, 0, 0.1); border-left: 4px solid #FFD700; border-radius: 8px; padding: 20px;">
                        <div style="color: #FFD700; font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            üü° 2. Review Open Ports
                        </div>
                        <div style="color: #E6EDF3; font-size: 0.9em; line-height: 1.5;">
                            {{ ports.count }} open ports detected. Review and close unnecessary services to reduce attack surface.
                        </div>
                    </div>
                    {% endif %}
                    
                    <div style="background: rgba(0, 255, 156, 0.1); border-left: 4px solid #00FF9C; border-radius: 8px; padding: 20px;">
                        <div style="color: #00FF9C; font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            üü¢ 3. Implement Security Headers
                        </div>
                        <div style="color: #E6EDF3; font-size: 0.9em; line-height: 1.5;">
                            Add security headers like CSP, HSTS, and X-Frame-Options to improve web application security.
                        </div>
                    </div>
                    
                    <div style="background: rgba(0, 191, 255, 0.1); border-left: 4px solid #00BFFF; border-radius: 8px; padding: 20px;">
                        <div style="color: #00BFFF; font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            üîµ 4. Regular Security Monitoring
                        </div>
                        <div style="color: #E6EDF3; font-size: 0.9em; line-height: 1.5;">
                            Schedule regular security scans and implement continuous monitoring to detect new vulnerabilities.
                        </div>
                    </div>
                </div>
                
                <!-- Next Steps -->
                <div style="margin-top: 25px; padding: 20px; background: rgba(186, 85, 211, 0.1); border-radius: 8px;">
                    <h4 style="color: #BA55D3; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="6" x2="12" y2="12"></line>
                            <line x1="16" y1="12" x2="12" y2="12"></line>
                        </svg>
                        Next Steps:
                    </h4>
                    <ul style="color: #E6EDF3; font-size: 0.9em; line-height: 1.6; margin: 0; padding-left: 20px;">
                        <li>Download detailed report for technical team</li>
                        <li>Prioritize fixes based on CVSS scores</li>
                        <li>Schedule follow-up scan after remediation</li>
                        <li>Implement security monitoring tools</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>  
  <!-- Action Buttons -->
    <div style="text-align: center; margin-top: 40px; padding: 30px; background: rgba(0, 0, 0, 0.2); border-radius: 12px;">
        <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
            <a href="{% url 'rescanai:index' %}" 
               style="background: linear-gradient(135deg, #00FF9C, #00E676); color: black; padding: 15px 30px; border-radius: 25px; text-decoration: none; font-weight: bold; font-size: 1.1em; transition: all 0.3s;">
                üè† Back to Dashboard
            </a>
            <a href="{% url 'rescanai:new_scan' %}" 
               style="background: linear-gradient(135deg, #00BFFF, #00CED1); color: white; padding: 15px 30px; border-radius: 25px; text-decoration: none; font-weight: bold; font-size: 1.1em; transition: all 0.3s;">
                üîç New Scan
            </a>
            <button onclick="window.print()" 
                    style="background: linear-gradient(135deg, #FFD700, #FFA500); color: black; padding: 15px 30px; border-radius: 25px; border: none; font-weight: bold; font-size: 1.1em; cursor: pointer; transition: all 0.3s;">
                üìÑ Print Report
            </button>
        </div>
    </div>
</div>

<style>
.severity-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.port-row:hover {
    background: rgba(0, 255, 156, 0.05);
    transform: translateX(5px);
}

.vuln-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
}

#ports-table th {
    position: sticky;
    top: 0;
    background: #161B22;
    z-index: 10;
}

/* Responsive Design */
@media (max-width: 768px) {
    .grid-responsive {
        grid-template-columns: 1fr !important;
    }
}

/* Print Styles */
@media print {
    body { background: white !important; color: black !important; }
    .no-print { display: none !important; }
}
</style>

<script>
// Enhanced search functionality
document.getElementById('port-search').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('.port-row');
    
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
});

// Enhanced vulnerability filtering
document.getElementById('vuln-search').addEventListener('input', filterVulnerabilities);
document.getElementById('severity-filter').addEventListener('change', filterVulnerabilities);

function filterVulnerabilities() {
    const searchTerm = document.getElementById('vuln-search').value.toLowerCase();
    const severityFilter = document.getElementById('severity-filter').value;
    const cards = document.querySelectorAll('.vuln-card');
    
    cards.forEach(card => {
        const text = card.textContent.toLowerCase();
        const severity = card.dataset.severity;
        
        const matchesSearch = text.includes(searchTerm);
        const matchesSeverity = !severityFilter || severity === severityFilter;
        
        card.style.display = matchesSearch && matchesSeverity ? '' : 'none';
    });
}

// Severity card click filtering
document.querySelectorAll('.severity-card').forEach(card => {
    card.addEventListener('click', function() {
        const severity = this.dataset.severity;
        document.getElementById('severity-filter').value = severity;
        filterVulnerabilities();
        
        // Visual feedback
        document.querySelectorAll('.severity-card').forEach(c => c.style.opacity = '0.5');
        this.style.opacity = '1';
        
        setTimeout(() => {
            document.querySelectorAll('.severity-card').forEach(c => c.style.opacity = '1');
        }, 2000);
    });
});

// Smooth animations on load
window.addEventListener('load', function() {
    const cards = document.querySelectorAll('.vuln-card, .severity-card, .port-row');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 50);
    });
});
</script>
{% endblock %}